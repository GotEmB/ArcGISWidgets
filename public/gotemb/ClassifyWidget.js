// Generated by CoffeeScript 1.4.0
var extend;

extend = function(obj, mixin) {
  var method, name;
  for (name in mixin) {
    method = mixin[name];
    obj[name] = method;
  }
  return obj;
};

define(["dojo/_base/declare", "dijit/_WidgetBase", "dijit/_TemplatedMixin", "dijit/_WidgetsInTemplateMixin", "dojo/text!./ClassifyWidget/templates/ClassifyWidget.html", "dijit/layout/BorderContainer", "dijit/layout/ContentPane", "dijit/form/TextBox", "dijit/form/Button", "esri/map", "esri/layers/FeatureLayer", "esri/tasks/query"], function(declare, _WidgetBase, _TemplatedMixin, _WidgetsInTemplateMixin, template) {
  return declare([_WidgetBase, _TemplatedMixin, _WidgetsInTemplateMixin], {
    templateString: template,
    baseClass: "classifyWidget",
    map: null,
    _imageServiceUrlInput: null,
    _signaturesUrlInput: null,
    _imageServiceLayer: null,
    _signaturesLayer: null,
    _addImageServiceLayer: function() {
      var _this = this;
      if (this._imageServiceLayer != null) {
        this.map.removeLayer(this._imageServiceLayer);
      }
      this._imageServiceLayer = new esri.layers.ArcGISImageServiceLayer(this._imageServiceUrlInput.get("value"));
      return dojo.connect(this._imageServiceLayer, "onLoad", function() {
        _this.map.addLayer(_this._imageServiceLayer);
        return _this.map.setExtent(_this._imageServiceLayer.initialExtent);
      });
    },
    _getSignaturesForExtent: function() {
      var _this = this;
      this._signaturesLayer = new esri.layers.FeatureLayer(this._signaturesUrlInput.get("value"));
      return dojo.connect(this._signaturesLayer, "onLoad", function() {
        return _this._signaturesLayer.selectFeatures(extend(new esri.tasks.Query(), {
          geometry: _this.map.extent,
          spatialRelationship: esri.tasks.Query.SPATIAL_REL_INTERSECTS,
          outFields: ["shape"]
        }), esri.layers.FeatureLayer.SELECTION_NEW, function(features) {
          return console.log(features);
        });
      });
    }
  });
});
